webpackJsonp([59],{1148:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a(218),i=a.n(r),n=a(812),o=a.n(n),s=a(807);e.default={props:{pointId:{type:Number,default:function(){return-1}},interval:{type:Number,default:function(){return 5}}},data:function(){return{historyDialog:!1,form:{interval:this.interval,starttime:new Date((new Date).getTime()-864e5),endtime:new Date},formRules:{starttime:[{type:"date",required:!0,message:"请选择开始时间",trigger:"change"}],endtime:[{type:"date",required:!0,message:"请选择结束时间",trigger:"change"}],interval:[{required:!0,message:"请输入时间间隔",trigger:"blur"}]},chartData:null,historyLoading:!1}},watch:{pointId:function(t){this.fetchChartData(this.form.starttime,this.form.endtime,this.form.interval)},historyDialog:function(t){var e=this;t&&this.$nextTick(function(){e.myChart=echarts.init(document.getElementById("chart-container")),window.addEventListener("resize",e.myChart.resize)})}},beforeDestroy:function(){this.myChart&&window.removeEventListener("resize",this.myChart.resize)},methods:{toggleDialog:function(){this.historyDialog=!this.historyDialog},search:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return!1;var a=e._dateFormat(e.form.starttime,"YYYY-MM-DD HH:mm"),r=e._dateFormat(e.form.endtime,"YYYY-MM-DD HH:mm");e.fetchChartData(a,r,e.form.interval)})},download:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return!1;var a=e._dateFormat(e.form.starttime,"YYYY-MM-DD HH:mm"),r=e._dateFormat(e.form.endtime,"YYYY-MM-DD HH:mm");window.location=BASE_URI+"/api/Device/ExportWaybillTag?start="+a+"&end="+r+"&pointId="+e.pointId+"&ts="+e.form.interval})},fetchChartData:function(t,e,r){var i=this;this.myChart&&this.myChart.clear(),this.historyLoading=!0,a.i(s.a)(this.pointId,t,e,r).then(function(t){var e=JSON.parse(t.data);if(e.success){var a=[];i.unitMap=e.Row[0].unitMap;for(var r=0;r<e.count;r++)!function(t){a.push({name:e.Row[t].pointname,type:"line",markLine:{data:[{type:"average",name:"平均数值"}],label:{normal:{formatter:"{b}:{c}"}}},markPoint:{data:[{type:"max",name:"最大值"},{type:"min",name:"最小值"}]},step:"1"===e.Row[t].type?"start":"",unit:e.Row[0].unit,smooth:!1,yAxisData:"1"===e.Row[t].type?o()(i.unitMap):"",data:function(){for(var a=[],r=e.Row[t].value.split(";"),i=0;i<r.length;i++){var n=r[i].split(",");a.push([new Date(n[1]).getTime(),parseFloat(n[0])])}return a}()})}(r);i.chartData=a,i.drawChart()}else i.chartData=[{data:[],type:"line"}],i.drawChart()}).catch(function(t){}).then(function(){i.historyLoading=!1})},drawChart:function(){var t={color:["#2297E8"],grid:{left:50,right:100,bottom:100,top:40},dataZoom:[{id:"dataZoomX",type:"slider",xAxisIndex:[0],filterMode:"filter"},{type:"inside",xAxisIndex:[0]}],toolbox:{right:20,feature:{dataZoom:{yAxisIndex:"none"},restore:{},saveAsImage:{}}},legend:{show:!0,data:[0===this.chartData[0].data.length?"":this.chartData[0].name],bottom:40},title:{text:0===this.chartData[0].data.length?"暂无数据":"",left:"center"},tooltip:{trigger:this.chartData[0].data.length&&"start"===this.chartData[0].step?"item":"axis",formatter:this.chartData[0].data.length&&"start"===this.chartData[0].step?[]:function(t){var e=t[0].data,a=new Date(e[0]),r=a.getMinutes();return r<10&&(r="0"+a.getMinutes()),'<i class="circlepoint" style="background:'+t[0].color+'"></i>'+a.getFullYear()+"/"+(a.getMonth()+1)+"/"+a.getDate()+"     "+a.getHours()+":"+r+" ,"+e[1]}},xAxis:{type:"time",splitLine:{show:!1}},yAxis:{type:"value",name:this.chartData[0].data.length?"单位:"+this.chartData[0].unit:"",boundaryGap:["20%","20%"],scale:!0},series:this.chartData},e={};e=this.chartData.length&&this.chartData[0].step?{yAxis:{type:"category",name:this.chartData[0].data.length?"单位:"+this.chartData[0].unit:"",data:this.chartData[0].yAxisData}}:{yAxis:{type:"value",name:this.chartData[0].data.length?"单位:"+this.chartData[0].unit:"",boundaryGap:["20%","20%"],scale:!0}},this.myChart.setOption(i()(t,e))},historyDialogClose:function(){this.chartData=[],this.form.interval="10",this.form.starttime=new Date((new Date).getTime()-144e5),this.form.endtime=new Date}}}},1586:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:"历史数据",visible:t.historyDialog,width:"1250px"},on:{"update:visible":function(e){t.historyDialog=e},close:t.historyDialogClose}},[a("div",{staticClass:"history-wrap2"},[a("div",[a("el-form",{ref:"form",staticClass:"search-form",attrs:{model:t.form,rules:t.formRules,"label-width":"105px",inline:""}},[a("el-form-item",{attrs:{label:"开始时间",prop:"starttime"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{editable:!1,type:"datetime",placeholder:"选择日期"},model:{value:t.form.starttime,callback:function(e){t.$set(t.form,"starttime",e)},expression:"form.starttime"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"结束时间",prop:"endtime"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{editable:!1,type:"datetime",placeholder:"选择日期"},model:{value:t.form.endtime,callback:function(e){t.$set(t.form,"endtime",e)},expression:"form.endtime"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"时间间隔(分)",prop:"interval"}},[a("el-input",{attrs:{placeholder:"分钟"},model:{value:t.form.interval,callback:function(e){t.$set(t.form,"interval","string"==typeof e?e.trim():e)},expression:"form.interval"}})],1),t._v(" "),a("el-form-item",{staticStyle:{"text-align":"center"}},[a("el-button",{attrs:{type:"primary"},nativeOn:{click:function(e){return t.search("form")}}},[t._v("\n            查看数据\n          ")]),t._v(" "),a("el-button",{nativeOn:{click:function(e){return t.download("form")}}},[t._v("\n            下载excel\n          ")])],1)],1)],1),t._v(" "),a("div",{staticClass:"history-chart"},[a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.historyLoading,expression:"historyLoading"}],staticStyle:{"min-width":"400px",height:"400px"},attrs:{id:"chart-container","element-loading-text":"加载中..."}})])])])},staticRenderFns:[]}},653:function(t,e,a){var r=a(38)(a(1148),a(1586),null,null);t.exports=r.exports},807:function(t,e,a){"use strict";a.d(e,"d",function(){return i}),a.d(e,"b",function(){return n}),a.d(e,"g",function(){return o}),a.d(e,"f",function(){return s}),a.d(e,"e",function(){return l}),a.d(e,"c",function(){return c}),a.d(e,"a",function(){return u});var r=a(32),i=function(t){return r.a.post("/api/Alarm/getClearTable",t)},n=function(t){return r.a.post("/api/Alarm/getAckedTable",t)},o=function(t){return r.a.post("/api/Alarm/getActivTable",t)},s=function(t){return r.a.get("/api/Alarm/queryDetail",{params:{id:t}})},l=function(t){return r.a.post("/api/Alarm/upDetail",t)},c=function(t){return r.a.get("/api/Alarm/updateStatus",{params:{id:t}})},u=function(t,e,a,i){return r.a.get("/api/Report/dataInfo",{params:{id:t,start:e,end:a,tmes:i}})}},812:function(t,e,a){t.exports={default:a(815),__esModule:!0}},815:function(t,e,a){a(817),t.exports=a(14).Object.values},816:function(t,e,a){var r=a(92),i=a(91),n=a(221).f;t.exports=function(t){return function(e){for(var a,o=i(e),s=r(o),l=s.length,c=0,u=[];l>c;)n.call(o,a=s[c++])&&u.push(t?[a,o[a]]:o[a]);return u}}},817:function(t,e,a){var r=a(39),i=a(816)(!1);r(r.S,"Object",{values:function(t){return i(t)}})}});