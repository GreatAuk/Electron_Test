webpackJsonp([17,32],{1136:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(226),a=r.n(n),i=r(132),o=r.n(i),s=r(908),l=r.n(s),c=r(225),u=r.n(c),p=r(710),m=r(541),d=r.n(m);e.default={components:{HistoryDialog:d.a},data:function(){return{mtid:null,pointList:[],total:null,listLoading:!0,searchForm:{id:Number(this.$store.state.app.pid),mtid:Number(this.$route.query.mtid),page:1,num:10,name:"",typeCn:"",alarmlevel:null,level:null,stime:"",etime:""},updatetime:null,formVisible:!1,searchId:null,filterData2:[{text:"记录",value:"记录"},{text:"一般",value:"一般"},{text:"重要",value:"重要"},{text:"紧急",value:"紧急"}],filterData1:[{text:"一级测点",value:"一级测点"},{text:"二级测点",value:"二级测点"},{text:"三级测点",value:"三级测点"},{text:"四级测点",value:"四级测点"}]}},mounted:function(){this.fetchpointData(),this.resetMainHeight()},methods:{fetchpointData:function(){var t=this;r.i(p.l)(this.searchForm).then(function(e){JSON.parse(e.data).success?(t.pointList=JSON.parse(e.data).list,t.total=JSON.parse(e.data).totalcount,t.listLoading=!1):(t.pointList=[],t.listLoading=!1)})},handleCurrentChange:function(t){this.searchForm.page=t,this.fetchpointData()},handleSizeChange:function(t){this.searchForm.num=t,this.fetchpointData()},tableheaderClass:function(t,e){return"header-row"},handleformVisible:function(){this.formVisible=!this.formVisible},resetForm:function(){this.searchForm.name="",this.searchForm.level="",this.searchForm.alarmlevel="",this.searchForm.typeCn="",this.updatetime="",this.fetchpointData()},handleformatTime:function(t){this.searchForm.stime=t[0],this.searchForm.etime=t[1]},openHistoryDialog:function(t){this.searchId=[t],this.$refs.historyDialog.toggleDialog()},filterTagAlarm:function(t,e){return e.alarmlevelname===t},filterTagLevel:function(t,e){return e.levelname===t},filterChange:function(t){var e=this;this.total=0,e.pointList=[],function(){function n(){return i.apply(this,arguments)}var i=u()(a.a.mark(function n(){var i,s,c,u,m,d;return a.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:e.listLoading=!0,i=!0,s=!1,c=void 0,n.prev=4,u=l()(t.alarmlevelname);case 6:if(i=(m=u.next()).done){n.next=14;break}return d=m.value,e.searchForm.alarmlevel="紧急"===d?"1":"重要"===d?"2":"一般"===d?"3":"4",n.next=11,r.i(p.l)(e.searchForm).then(function(t){JSON.parse(t.data).success?(e.pointList=[].concat(o()(JSON.parse(t.data).list),o()(e.pointList)),e.total+=JSON.parse(t.data).totalcount):(e.pointList=[],e.listLoading=!1)});case 11:i=!0,n.next=6;break;case 14:n.next=20;break;case 16:n.prev=16,n.t0=n.catch(4),s=!0,c=n.t0;case 20:n.prev=20,n.prev=21,!i&&u.return&&u.return();case 23:if(n.prev=23,!s){n.next=26;break}throw c;case 26:return n.finish(23);case 27:return n.finish(20);case 28:e.listLoading=!1;case 29:case"end":return n.stop()}},n,this,[[4,16,20,28],[21,,23,27]])}));return n}()()},tableRowClassName:function(t){var e=t.row;t.rowIndex;return""!==e.alarmactive&&Number(e.alarmactive)>0?"warning-row":""},resetMainHeight:function(){document.body.style.height="101%",setTimeout(function(){document.body.style.height="100%"},0)}}}},1279:function(t,e,r){e=t.exports=r(539)(),e.push([t.i,".params-container .el-table .warning-row{background:#fef0f0}.circlepoint{display:inline-block;width:.6em;height:.6em;margin-right:5px;border-radius:50%}",""])},1409:function(t,e,r){var n=r(1279);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);r(540)("4664af43",n,!0)},1561:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"pdg2"},[r("div",{staticClass:"params-container"},[r("div",{staticClass:"params-wrap"},[r("div",{staticClass:"searchBox"},[r("el-form",{ref:"searchForm",attrs:{"label-width":"70px"},model:{value:t.searchForm,callback:function(e){t.searchForm=e},expression:"searchForm"}},[r("el-row",{attrs:{gutter:48}},[r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"设备名称"}},[r("el-input",{attrs:{size:"small",placeholder:"请输入",clearable:""},model:{value:t.searchForm.name,callback:function(e){t.$set(t.searchForm,"name","string"==typeof e?e.trim():e)},expression:"searchForm.name"}})],1)],1),t._v(" "),r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"测点级别"}},[r("el-select",{staticClass:"w100",attrs:{size:"small",placeholder:"请选择",clearable:""},model:{value:t.searchForm.level,callback:function(e){t.$set(t.searchForm,"level",e)},expression:"searchForm.level"}},[r("el-option",{attrs:{label:"一级测点",value:"1"}}),t._v(" "),r("el-option",{attrs:{label:"二级测点",value:"2"}}),t._v(" "),r("el-option",{attrs:{label:"三级测点",value:"3"}})],1)],1)],1),t._v(" "),t.formVisible?r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"报警级别"}},[r("el-select",{staticClass:"w100",attrs:{size:"small",placeholder:"请选择",clearable:""},model:{value:t.searchForm.alarmlevel,callback:function(e){t.$set(t.searchForm,"alarmlevel",e)},expression:"searchForm.alarmlevel"}},[r("el-option",{attrs:{label:"紧急",value:"1"}}),t._v(" "),r("el-option",{attrs:{label:"重要",value:"2"}}),t._v(" "),r("el-option",{attrs:{label:"一般",value:"3"}}),t._v(" "),r("el-option",{attrs:{label:"记录",value:"4"}})],1)],1)],1):t._e(),t._v(" "),t.formVisible?r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"设备类型"}},[r("el-input",{attrs:{size:"small",placeholder:"请输入"},model:{value:t.searchForm.typeCn,callback:function(e){t.$set(t.searchForm,"typeCn","string"==typeof e?e.trim():e)},expression:"searchForm.typeCn"}})],1)],1):t._e(),t._v(" "),t.formVisible?r("el-col",{attrs:{span:8}},[r("el-form-item",{attrs:{label:"更新时间"}},[r("el-date-picker",{staticStyle:{width:"100%"},attrs:{size:"small",type:"datetimerange","value-format":"yyyy-MM-dd HH:mm:ss","start-placeholder":"开始时间","end-placeholder":"结束时间",clearable:"",placeholder:"请选择"},on:{change:t.handleformatTime},model:{value:t.updatetime,callback:function(e){t.updatetime=e},expression:"updatetime"}})],1)],1):t._e(),t._v(" "),r("el-col",{staticClass:"handleWrapper",attrs:{span:8}},[r("el-form-item",[r("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-search"},nativeOn:{click:function(e){return t.fetchpointData(e)}}},[t._v("\n                  搜索\n                ")]),t._v(" "),r("el-button",{attrs:{size:"small",type:"danger",icon:"el-icon-refresh"},on:{click:t.resetForm}},[t._v("\n                  重置\n                ")]),t._v(" "),r("div",{staticClass:"searchBtn"},[r("el-button",{staticStyle:{padding:"4px 0"},attrs:{icon:t.formVisible?"el-icon-arrow-up":"el-icon-arrow-down",type:"text",size:"mini"},on:{click:t.handleformVisible}},[t._v("\n                    "+t._s(t.formVisible?"收起":"展开")+"\n                  ")])],1)],1)],1)],1)],1)],1),t._v(" "),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],attrs:{data:t.pointList,fit:"","element-loading-text":"加载中...","header-row-class-name":t.tableheaderClass,"row-class-name":t.tableRowClassName}},[r("el-table-column",{attrs:{type:"index",label:"序号",width:"60",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[r("span",[t._v(t._s(t.searchForm.num*(t.searchForm.page-1)+1+e.$index))])]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"区域",prop:"area"}}),t._v(" "),r("el-table-column",{attrs:{prop:"name",label:"名称"}}),t._v(" "),r("el-table-column",{attrs:{prop:"typeCn",label:"类型"}}),t._v(" "),r("el-table-column",{attrs:{label:"当前值",prop:"valuename",sortable:""},scopedSlots:t._u([{key:"default",fn:function(e){return[r("span",{class:{online:"开"===e.row.valuename,offline:"关"===e.row.valuename,active:""!==e.row.alarmactive&&Number(e.row.alarmactive)>0,normal:Number(e.row.alarmactive)<=0},staticStyle:{cursor:"pointer"},on:{click:function(r){return t.openHistoryDialog(e.row.id)}}},[t._v(t._s(e.row.valuename))])]}}])}),t._v(" "),r("el-table-column",{attrs:{prop:"updatetime",label:"更新时间",sortable:""}}),t._v(" "),r("el-table-column",{attrs:{prop:"Pname",label:"测点位置"}}),t._v(" "),r("el-table-column",{attrs:{label:"测点级别",width:"150px",prop:"tag",filters:t.filterData1,"filter-method":t.filterTagLevel,"filter-placement":"bottom-end"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("span",{staticStyle:{"margin-left":"10px"}},[t._v(t._s(e.row.levelname))])]}}])}),t._v(" "),r("el-table-column",{attrs:{label:"报警级别",width:"100px",prop:"tag",filters:t.filterData2,"filter-method":t.filterTagAlarm,"filter-placement":"bottom-end","column-key":"alarmlevelname"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("el-tag",{attrs:{size:"small",type:"记录"===e.row.alarmlevelname?"primary":"一般"===e.row.alarmlevelname?"info":"重要"===e.row.alarmlevelname?"warning":"danger","disable-transitions":""}},[t._v("\n              "+t._s(e.row.alarmlevelname)+"\n            ")])]}}])})],1),t._v(" "),r("div",{staticClass:"paginationBox"},[r("el-pagination",{attrs:{background:"","current-page":t.searchForm.page,"page-sizes":[10,20,50,100],"page-size":t.searchForm.num,layout:"total, sizes, prev, pager, next, jumper",total:t.total},on:{"update:currentPage":function(e){return t.$set(t.searchForm,"page",e)},"update:current-page":function(e){return t.$set(t.searchForm,"page",e)},"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}})],1)],1)]),t._v(" "),r("HistoryDialog",{ref:"historyDialog",attrs:{"point-ids":t.searchId}})],1)},staticRenderFns:[]}},541:function(t,e,r){r(708);var n=r(38)(r(706),r(709),null,null);t.exports=n.exports},639:function(t,e,r){r(1409);var n=r(38)(r(1136),r(1561),null,null);t.exports=n.exports},684:function(t,e,r){var n=r(133)("meta"),a=r(58),i=r(69),o=r(59).f,s=0,l=Object.isExtensible||function(){return!0},c=!r(68)(function(){return l(Object.preventExtensions({}))}),u=function(t){o(t,n,{value:{i:"O"+ ++s,w:{}}})},p=function(t,e){if(!a(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!i(t,n)){if(!l(t))return"F";if(!e)return"E";u(t)}return t[n].i},m=function(t,e){if(!i(t,n)){if(!l(t))return!0;if(!e)return!1;u(t)}return t[n].w},d=function(t){return c&&f.NEED&&l(t)&&!i(t,n)&&u(t),t},f=t.exports={KEY:n,NEED:!1,fastKey:p,getWeak:m,onFreeze:d}},685:function(t,e,r){var n=r(58);t.exports=function(t,e){if(!n(t)||t._t!==e)throw TypeError("Incompatible receiver, "+e+" required!");return t}},686:function(t,e,r){var n=r(70);t.exports=Array.isArray||function(t){return"Array"==n(t)}},687:function(t,e,r){t.exports={default:r(688),__esModule:!0}},688:function(t,e,r){r(215),r(134),r(213),r(698),r(701),r(700),r(699),t.exports=r(14).Set},689:function(t,e,r){var n=r(210);t.exports=function(t,e){var r=[];return n(t,!1,r.push,r,e),r}},690:function(t,e,r){var n=r(60),a=r(136),i=r(72),o=r(90),s=r(692);t.exports=function(t,e){var r=1==t,l=2==t,c=3==t,u=4==t,p=6==t,m=5==t||p,d=e||s;return function(e,s,f){for(var h,v,g=i(e),y=a(g),b=n(s,f,3),w=o(y.length),x=0,_=r?d(e,w):l?d(e,0):void 0;w>x;x++)if((m||x in y)&&(h=y[x],v=b(h,x,g),t))if(r)_[x]=v;else if(v)switch(t){case 3:return!0;case 5:return h;case 6:return x;case 2:_.push(h)}else if(u)return!1;return p?-1:c||u?u:_}}},691:function(t,e,r){var n=r(58),a=r(686),i=r(21)("species");t.exports=function(t){var e;return a(t)&&(e=t.constructor,"function"!=typeof e||e!==Array&&!a(e.prototype)||(e=void 0),n(e)&&null===(e=e[i])&&(e=void 0)),void 0===e?Array:e}},692:function(t,e,r){var n=r(691);t.exports=function(t,e){return new(n(t))(e)}},693:function(t,e,r){"use strict";var n=r(59).f,a=r(214),i=r(212),o=r(60),s=r(211),l=r(210),c=r(137),u=r(216),p=r(217),m=r(61),d=r(684).fastKey,f=r(685),h=m?"_s":"size",v=function(t,e){var r,n=d(e);if("F"!==n)return t._i[n];for(r=t._f;r;r=r.n)if(r.k==e)return r};t.exports={getConstructor:function(t,e,r,c){var u=t(function(t,n){s(t,u,e,"_i"),t._t=e,t._i=a(null),t._f=void 0,t._l=void 0,t[h]=0,void 0!=n&&l(n,r,t[c],t)});return i(u.prototype,{clear:function(){for(var t=f(this,e),r=t._i,n=t._f;n;n=n.n)n.r=!0,n.p&&(n.p=n.p.n=void 0),delete r[n.i];t._f=t._l=void 0,t[h]=0},delete:function(t){var r=f(this,e),n=v(r,t);if(n){var a=n.n,i=n.p;delete r._i[n.i],n.r=!0,i&&(i.n=a),a&&(a.p=i),r._f==n&&(r._f=a),r._l==n&&(r._l=i),r[h]--}return!!n},forEach:function(t){f(this,e);for(var r,n=o(t,arguments.length>1?arguments[1]:void 0,3);r=r?r.n:this._f;)for(n(r.v,r.k,this);r&&r.r;)r=r.p},has:function(t){return!!v(f(this,e),t)}}),m&&n(u.prototype,"size",{get:function(){return f(this,e)[h]}}),u},def:function(t,e,r){var n,a,i=v(t,e);return i?i.v=r:(t._l=i={i:a=d(e,!0),k:e,v:r,p:n=t._l,n:void 0,r:!1},t._f||(t._f=i),n&&(n.n=i),t[h]++,"F"!==a&&(t._i[a]=i)),t},getEntry:v,setStrong:function(t,e,r){c(t,e,function(t,r){this._t=f(t,e),this._k=r,this._l=void 0},function(){for(var t=this,e=t._k,r=t._l;r&&r.r;)r=r.p;return t._t&&(t._l=r=r?r.n:t._t._f)?"keys"==e?u(0,r.k):"values"==e?u(0,r.v):u(0,[r.k,r.v]):(t._t=void 0,u(1))},r?"entries":"values",!r,!0),p(e)}}},694:function(t,e,r){var n=r(135),a=r(689);t.exports=function(t){return function(){if(n(this)!=t)throw TypeError(t+"#toJSON isn't generic");return a(this)}}},695:function(t,e,r){"use strict";var n=r(15),a=r(39),i=r(684),o=r(68),s=r(52),l=r(212),c=r(210),u=r(211),p=r(58),m=r(89),d=r(59).f,f=r(690)(0),h=r(61);t.exports=function(t,e,r,v,g,y){var b=n[t],w=b,x=g?"set":"add",_=w&&w.prototype,S={};return h&&"function"==typeof w&&(y||_.forEach&&!o(function(){(new w).entries().next()}))?(w=e(function(e,r){u(e,w,t,"_c"),e._c=new b,void 0!=r&&c(r,g,e[x],e)}),f("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),function(t){var e="add"==t||"set"==t;t in _&&(!y||"clear"!=t)&&s(w.prototype,t,function(r,n){if(u(this,w,t),!e&&y&&!p(r))return"get"==t&&void 0;var a=this._c[t](0===r?0:r,n);return e?this:a})}),y||d(w.prototype,"size",{get:function(){return this._c.size}})):(w=v.getConstructor(e,t,g,x),l(w.prototype,r),i.NEED=!0),m(w,t),S[t]=w,a(a.G+a.W+a.F,S),y||v.setStrong(w,t,g),w}},696:function(t,e,r){"use strict";var n=r(39),a=r(71),i=r(60),o=r(210);t.exports=function(t){n(n.S,t,{from:function(t){var e,r,n,s,l=arguments[1];return a(this),e=void 0!==l,e&&a(l),void 0==t?new this:(r=[],e?(n=0,s=i(l,arguments[2],2),o(t,!1,function(t){r.push(s(t,n++))})):o(t,!1,r.push,r),new this(r))}})}},697:function(t,e,r){"use strict";var n=r(39);t.exports=function(t){n(n.S,t,{of:function(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];return new this(e)}})}},698:function(t,e,r){"use strict";var n=r(693),a=r(685);t.exports=r(695)("Set",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return n.def(a(this,"Set"),t=0===t?0:t,t)}},n)},699:function(t,e,r){r(696)("Set")},700:function(t,e,r){r(697)("Set")},701:function(t,e,r){var n=r(39);n(n.P+n.R,"Set",{toJSON:r(694)("Set")})},702:function(t,e,r){var n,a=a||function(t){"use strict";if(!(void 0===t||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var e=t.document,r=function(){return t.URL||t.webkitURL||t},n=e.createElementNS("http://www.w3.org/1999/xhtml","a"),a="download"in n,i=function(t){var e=new MouseEvent("click");t.dispatchEvent(e)},o=/constructor/i.test(t.HTMLElement)||t.safari,s=/CriOS\/[\d]+/.test(navigator.userAgent),l=function(e){(t.setImmediate||t.setTimeout)(function(){throw e},0)},c=function(t){var e=function(){"string"==typeof t?r().revokeObjectURL(t):t.remove()};setTimeout(e,4e4)},u=function(t,e,r){e=[].concat(e);for(var n=e.length;n--;){var a=t["on"+e[n]];if("function"==typeof a)try{a.call(t,r||t)}catch(t){l(t)}}},p=function(t){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(t.type)?new Blob([String.fromCharCode(65279),t],{type:t.type}):t},m=function(e,l,m){m||(e=p(e));var d,f=this,h=e.type,v="application/octet-stream"===h,g=function(){u(f,"writestart progress write writeend".split(" "))};if(f.readyState=f.INIT,a)return d=r().createObjectURL(e),void setTimeout(function(){n.href=d,n.download=l,i(n),g(),c(d),f.readyState=f.DONE});!function(){if((s||v&&o)&&t.FileReader){var n=new FileReader;return n.onloadend=function(){var e=s?n.result:n.result.replace(/^data:[^;]*;/,"data:attachment/file;");t.open(e,"_blank")||(t.location.href=e),e=void 0,f.readyState=f.DONE,g()},n.readAsDataURL(e),void(f.readyState=f.INIT)}if(d||(d=r().createObjectURL(e)),v)t.location.href=d;else{t.open(d,"_blank")||(t.location.href=d)}f.readyState=f.DONE,g(),c(d)}()},d=m.prototype,f=function(t,e,r){return new m(t,e||t.name||"download",r)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(t,e,r){return e=e||t.name||"download",r||(t=p(t)),navigator.msSaveOrOpenBlob(t,e)}:(d.abort=function(){},d.readyState=d.INIT=0,d.WRITING=1,d.DONE=2,d.error=d.onwritestart=d.onprogress=d.onwrite=d.onabort=d.onerror=d.onwriteend=null,f)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);void 0!==t&&t.exports?t.exports.saveAs=a:null!==r(703)&&null!==r(704)&&void 0!==(n=function(){return a}.call(e,r,e,t))&&(t.exports=n)},703:function(t,e){t.exports=function(){throw new Error("define cannot be used indirect")}},704:function(t,e){(function(e){t.exports=e}).call(e,{})},705:function(t,e,r){"use strict";r.d(e,"b",function(){return o}),r.d(e,"a",function(){return s});var n=r(32),a=r(219),i=r.n(a),o=function(t){var e=t.companyId,r=t.waybillNumOrTagId,a=t.pageIndex,i=t.pageSize;return n.a.get(BASE_URI+"/api/Device/GetWaybillPage",{params:{companyId:e,waybillNumOrTagId:r,pageIndex:a,pageSize:i}})},s=function(t){var e=t.start,r=t.end,a=t.pointIdList,o=t.tmes;return n.a.get(BASE_URI+"/api/Device/GetPointData",{params:{start:e,end:r,pointIdList:a,tmes:o},paramsSerializer:function(t){return i.a.stringify(t,{indices:!1})}})}},706:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(218),a=r.n(n),i=r(220),o=r.n(i),s=r(687),l=r.n(s),c=r(132),u=r.n(c),p=r(705),m=r(702),d=(r.n(m),r(138));e.default={props:{type:{type:String,default:function(){""}},pointIds:{type:Array,default:function(){return[]}},interval:{type:Number,default:function(){return 5}},startTime:{type:Date,default:function(){return new Date((new Date).getTime()-864e5)}},endTime:{type:Date,default:function(){return new Date}}},data:function(){return{dialogVisible:!1,form:{interval:this.interval,startTime:this.startTime,endTime:this.endTime},formRules:{startTime:[{type:"date",required:!0,message:"选择开始时间",trigger:"change"}],endTime:[{type:"date",required:!0,message:"选择结束时间",trigger:"change"}],interval:[{required:!0,message:"输入时间间隔(整数)",type:"number",trigger:"blur"}]},pointType:0,showStatistical:!1,showThreshold:!1,pdfLoading:!1,chartLoading:!1}},computed:{industry:function(){return this.$store.state.app.company.industry}},watch:{pointIds:function(t){t&&t.length&&this.fetchChartSeries()},startTime:function(t){this.form.startTime=t},endTime:function(t){this.form.endTime=t},interval:function(t){this.form.interval=t},dialogVisible:function(t){var e=this;t&&this.$nextTick(function(){e.myChart=echarts.init(document.getElementById("echart-wrap"))})}},mounted:function(){this.chartSeries=null},beforeDestroy:function(){},methods:{toggleDialog:function(){this.dialogVisible=!this.dialogVisible},thresholdChang:function(t){this.drawChart()},statisticalChange:function(t){this.drawChart()},search:function(t){var e=this;this.$refs[t].validate(function(t){if(!t)return!1;e.fetchChartSeries()})},downPDF:function(t){var e=this;this.$refs[t].validate(function(t){t&&(e.pdfLoading=!0,e.fetchChartSeries())})},downImg:function(){r.i(m.saveAs)(r.i(d.b)(this.myChart.getDataURL()),"chart.jpg")},downloadExcel:function(t){var e=this;this.$refs[t].validate(function(t){if(t){var r=e._dateFormat(e.form.startTime,"YYYY-MM-DD HH:mm"),n=e._dateFormat(e.form.endTime,"YYYY-MM-DD HH:mm");window.location.href=_host+"/api/Report/downHistoryData?id="+e.pointIds.join(",")+"&start="+r+"&end="+n+"&tmes="+e.form.interval}})},fetchChartSeries:function(){var t=this;this.chartLoading=!0,r.i(p.a)({start:this._dateFormat(this.form.startTime,"YYYY-MM-DD HH:mm"),end:this._dateFormat(this.form.endTime,"YYYY-MM-DD HH:mm"),pointIdList:this.pointIds,tmes:this.form.interval}).then(function(e){if(200===e.data.Code){t.dataSource=e.data.Data;var r=e.data.Data.PointList;if(!r)return t.$message("无点位数据"),!1;var n=r.map(function(t){return t.PointType});if(t.legends=r.map(function(t){return t.PointName}),1!==[].concat(u()(new l.a(n))).length)return t.$message({message:"选中的多个点位不是同一类型，无法合理显示",type:"info",duration:5e3}),!1;t.pointType=n[0],0===t.pointType&&(t.showStatistical=!0);var a=[];r.forEach(function(t){for(var e=0,r=t.DataList.length;e<r;e++)t.DataList[e]=[t.DataList[e].Time,t.DataList[e].Value];t.unitMap={},t.UnitMap&&t.UnitMap.forEach(function(e){t.unitMap[e.key]=e.value}),a.push({animation:!1,name:t.PointName,type:"line",unit:t.Unit,step:1===t.PointType?"start":"",smooth:!1,yAxisData:1===t.PointType?o()(t.unitMap).map(function(t){return parseInt(t)}):"",pointType:t.PointType,unitMap:t.unitMap,data:t.DataList,markLine:{data:[]},statisticalmarkLineData:[{type:"average",name:"",lineStyle:{type:"dashed"},label:{normal:{formatter:function(t){return t.value.toFixed(1)}}}}],ThresholdmarkLineData:function(){var e=[];return t.SuperLowerLimit&&e.push({yAxis:t.SuperLowerLimit,lineStyle:{color:"#B03A5B",type:"dotted"},label:{show:!0,position:"middle",formatter:function(e){return"下下限("+t.PointName+"): "+t.SuperLowerLimit}}}),t.SuperUpperLimit&&e.push({yAxis:t.SuperUpperLimit,lineStyle:{color:"#B03A5B",type:"dotted"},label:{show:!0,position:"middle",formatter:function(e){return"上上限("+t.PointName+"): "+t.SuperUpperLimit}}}),t.UpperLimit&&e.push({yAxis:t.UpperLimit,lineStyle:{color:"#B03A5B",type:"dotted"},label:{show:!0,position:"middle",formatter:function(e){return"上限("+t.PointName+"): "+t.UpperLimit}}}),t.LowerLimit&&e.push({yAxis:t.LowerLimit,lineStyle:{color:"#B03A5B",type:"dotted"},label:{show:!0,position:"middle",formatter:function(e){return"下限("+t.PointName+"): "+t.LowerLimit}}}),e}(),markPointCopy:{data:[{type:"max",name:"最大值"},{type:"min",name:"最小值"}]},superLowerLimit:t.SuperLowerLimit,superUpperLimit:t.SuperUpperLimit,upperLimit:t.UpperLimit,lowerLimit:t.LowerLimit})}),t.chartSeries=a,t.drawChart()}else t.$message.error("历史数据查询失败")}).catch(function(e){t.$message.error("历史数据查询失败")}).finally(function(){t.chartLoading=!1})},drawChart:function(){var t=this;this.myChart&&this.myChart.clear(),this.chartSeries.forEach(function(e){if(e.markLine.data=[],t.showStatistical){var r;e.markPoint=e.markPointCopy,(r=e.markLine.data).push.apply(r,u()(e.statisticalmarkLineData))}else delete e.markPoint;if(t.showThreshold){var n;e.ThresholdmarkLineData.length||(1===t.chartSeries.length?t.$message("选中点位没有设置阈值"):t.$message("存在点位没有设置阈值")),(n=e.markLine.data).push.apply(n,u()(e.ThresholdmarkLineData))}});var e={color:["#2297E8","#48CE38","#F8D156","#FD9827","#9764DC","#1FCA6A"],grid:{left:60,right:100,bottom:80,top:40},dataZoom:[{type:"slider",xAxisIndex:0,filterMode:"empty",handleIcon:"M10.7,11.9H9.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4h1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z",handleSize:"90%"},{type:"inside",xAxisIndex:0,filterMode:"empty"}],legend:{show:!0},tooltip:{trigger:"axis",formatter:function(e){for(var r=t._dateFormat(e[0].axisValue,"YYYY-MM-DD HH:mm")+"<br/>",n=0;n<e.length;n++)r+=function(t){return'<i class="circlepoint" style="background: '+t+'"></i>'}(e[n].color)+" "+e[n].seriesName+"："+(null===e[n].value[1]?"无数据":e[n].value[1])+" <br/>";return r}},xAxis:{type:"time",axisLabel:{formatter:function(e,r){return t._dateFormat(e,"YYYY-MM-DD HH:mm")}},splitLine:{show:!1}},series:this.chartSeries},n={};if(n=this.chartSeries.length&&this.chartSeries[0].step?{yAxis:{type:"value",name:this.chartSeries[0].data.length?"单位:"+this.chartSeries[0].unit:"",boundaryGap:["20%","20%"],minInterval:1,axisLabel:{show:!0,formatter:function(e){if(t.chartSeries[0].unitMap[e])return t.chartSeries[0].unitMap[e]}}}}:{yAxis:{type:"value",name:this.chartSeries[0].data.length?"单位:"+this.chartSeries[0].unit:"",scale:!1,boundaryGap:["20%","20%"]}},1!==this.chartSeries[0].pointType&&e.dataZoom.push({type:"slider",yAxisIndex:0,filterMode:"empty",handleIcon:"M10.7,11.9H9.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4h1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z",handleSize:"90%"}),this.myChart.setOption(a()(e,n)),!0===this.pdfLoading){this.dataSource.startTime=this._dateFormat(this.form.startTime,"YYYY-MM-DD HH:mm"),this.dataSource.endTime=this._dateFormat(this.form.endTime,"YYYY-MM-DD HH:mm");try{var i=r.i(d.c)(this.myChart.getDataURL(),this.dataSource),o=new URLSearchParams;o.append("html",i),fetch("https://sinocold.net:8443/api/Report/DownloadDataPDF",{method:"POST",body:o,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){return t.json()}).then(function(t){window.open("https://sinocold.net:8443"+t)}).catch(function(e){t.$message.error("导出失败")}).finally(function(){t.pdfLoading=!1})}catch(t){this.pdfLoading=!1,this.$message.error("导出失败")}}},historyDialogClose:function(){this.myChart&&this.myChart.clear(),this.chartSeries=[],this.showStatistical=!1,this.showThreshold=!1,this.form.interval=this.interval,this.form.startTime=new Date((new Date).getTime()-864e5),this.form.endTime=new Date}}}},707:function(t,e,r){e=t.exports=r(539)(),e.push([t.i,".history-dialog-wrap .circlepoint{display:inline-block;width:.6em;height:.6em;margin-right:5px;border-radius:50%}",""])},708:function(t,e,r){var n=r(707);"string"==typeof n&&(n=[[t.i,n,""]]),n.locals&&(t.exports=n.locals);r(540)("060cc275",n,!0)},709:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("el-dialog",{attrs:{title:"历史数据",visible:t.dialogVisible,width:"1300px",top:"10vh"},on:{"update:visible":function(e){t.dialogVisible=e},close:t.historyDialogClose}},[r("div",{staticClass:"history-dialog-wrap"},[r("div",[r("el-form",{ref:"form",staticStyle:{"margin-left":"45px"},attrs:{model:t.form,rules:t.formRules,inline:"",size:"medium","hide-required-asterisk":!0}},[r("el-form-item",{attrs:{label:"时间范围：",prop:"startTime"}},[r("el-date-picker",{staticStyle:{width:"100%"},attrs:{format:"yyyy-MM-dd HH:mm",editable:!1,type:"datetime",placeholder:"选择日期"},model:{value:t.form.startTime,callback:function(e){t.$set(t.form,"startTime",e)},expression:"form.startTime"}})],1),t._v(" "),r("span",{staticStyle:{"margin-right":"10px",position:"relative",top:"9px"}},[t._v("-")]),t._v(" "),r("el-form-item",{attrs:{prop:"endTime"}},[r("el-date-picker",{staticStyle:{width:"100%"},attrs:{format:"yyyy-MM-dd HH:mm",editable:!1,type:"datetime",placeholder:"选择日期"},model:{value:t.form.endTime,callback:function(e){t.$set(t.form,"endTime",e)},expression:"form.endTime"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"间隔：",prop:"interval"}},[r("el-input",{attrs:{placeholder:"分钟"},model:{value:t.form.interval,callback:function(e){t.$set(t.form,"interval",t._n("string"==typeof e?e.trim():e))},expression:"form.interval"}})],1),t._v(" "),r("span",{staticStyle:{position:"relative",top:"9px"}},[t._v("分钟")]),t._v(" "),r("el-form-item",{staticStyle:{"margin-left":"20px"}},[r("el-button",{attrs:{loading:t.chartLoading,size:"medium",type:"primary"},nativeOn:{click:function(e){return t.search("form")}}},[t._v("\n            查看数据\n          ")])],1),t._v(" "),r("div",[r("el-form-item",{attrs:{label:"数据操作："}},[1!==t.industry?r("el-button",{attrs:{size:"medium"},nativeOn:{click:function(e){return t.downloadExcel("form")}}},[t._v("\n              下载excel\n            ")]):t._e(),t._v(" "),r("el-button",{attrs:{loading:t.pdfLoading,size:"medium"},nativeOn:{click:function(e){return t.downPDF("form")}}},[t._v("\n              下载pdf\n            ")]),t._v(" "),r("el-button",{attrs:{size:"medium"},nativeOn:{click:function(e){return t.downImg(e)}}},[t._v("\n              下载图表\n            ")])],1),t._v(" "),r("el-form-item",{staticStyle:{"margin-left":"15px"},attrs:{label:"显示统计"}},[r("el-switch",{staticStyle:{"margin-left":"10px",position:"relative",top:"-3px"},attrs:{disabled:1===t.pointType},on:{change:t.statisticalChange},model:{value:t.showStatistical,callback:function(e){t.showStatistical=e},expression:"showStatistical"}})],1),t._v(" "),r("el-form-item",{staticStyle:{"margin-left":"15px"},attrs:{label:"显示阈值"}},[r("el-switch",{staticStyle:{"margin-left":"10px",position:"relative",top:"-3px"},attrs:{disabled:1===t.pointType},on:{change:t.thresholdChang},model:{value:t.showThreshold,callback:function(e){t.showThreshold=e},expression:"showThreshold"}})],1)],1)],1)],1),t._v(" "),r("div",{staticClass:"history-chart"},[r("div",{directives:[{name:"loading",rawName:"v-loading",value:t.chartLoading,expression:"chartLoading"}],staticStyle:{"min-width":"400px",height:"450px"},attrs:{id:"echart-wrap","element-loading-text":"加载中..."}})])])])},staticRenderFns:[]}},710:function(t,e,r){"use strict";r.d(e,"y",function(){return a}),r.d(e,"x",function(){return i}),r.d(e,"m",function(){return o}),r.d(e,"b",function(){return s}),r.d(e,"h",function(){return l}),r.d(e,"c",function(){return c}),r.d(e,"w",function(){return u}),r.d(e,"a",function(){return p}),r.d(e,"l",function(){return m}),r.d(e,"i",function(){return d}),r.d(e,"j",function(){return f}),r.d(e,"k",function(){return h}),r.d(e,"e",function(){return v}),r.d(e,"f",function(){return g}),r.d(e,"d",function(){return y}),r.d(e,"g",function(){return b}),r.d(e,"n",function(){return w}),r.d(e,"o",function(){return x}),r.d(e,"p",function(){return _}),r.d(e,"q",function(){return S}),r.d(e,"r",function(){return L}),r.d(e,"s",function(){return T}),r.d(e,"t",function(){return D}),r.d(e,"u",function(){return k}),r.d(e,"v",function(){return C});var n=r(32),a=function(t){return n.a.get("/api/model/getchild",{params:{project:t}})},i=function(t,e,r,a,i,o){return n.a.get("/api/model/queryDeviceInfo",{params:{project:t,sid:e,model:r,inp:a,num:i,page:o}})},o=function(t,e,r,a,i,o,s){return n.a.get("/api/model/getTableList",{params:{project:t,sid:e,mname:r,model:a,page:i,num:o,pname:s}})},s=function(t,e){return n.a.get("/api/model/getTab",{params:{project:t,sid:e}})},l=function(t,e,r,a){return n.a.get("/api/Report/dataInfo",{params:{id:t,start:e,end:r,tmes:a}})},c=function(t,e,r,a,i,o){return n.a.get("/api/model/getCard",{params:{project:t,sid:e,model:r,inp:a,page:i,num:o}})},u=function(t){return n.a.post("/api/model/alarmTable",t)},p=function(t){return n.a.post("/api/model/showTable",t)},m=function(t){return n.a.post("/api/model/queryPoint",t)},d=function(t,e,r,a,i){return n.a.get("/api/model/GetDmplist",{params:{project:t,sid:e,startTime:r,endTime:a,type:i}})},f=function(t,e,r,a){return n.a.get("/api/model/GetArealist",{params:{project:t,sid:e,startTime:r,endTime:a}})},h=function(t,e,r,a,i){return n.a.get("/api/model/GetPersonlist",{params:{project:t,sid:e,startTime:r,endTime:a,type:i}})},v=function(t){return n.a.post("/api/car/getCarList",t)},g=function(t){return n.a.get("/api/car/getCarInfo",{params:{id:t}})},y=function(t){return n.a.get("/api/car/getdataInfo",{params:{id:t}})},b=function(t){return n.a.post("/api/car/updateCarInfo",t)},w=function(t){return n.a.get("/api/model/getSymbol",{params:{mtid:t}})},x=function(t){return n.a.get("/api/model/deviceInfo",{params:{mtid:t}})},_=function(t){return n.a.get("/api/model/contact",{params:{mtid:t}})},S=function(t,e){return n.a.get("/api/model/normal",{params:{pid:t,mtid:e}})},L=function(t,e,r,a){return n.a.get("/api/Report/dataInfo",{params:{pid:t,start:e,end:r,tmes:a}})},T=function(t){return n.a.post("/api/alarm/",t)},D=function(t){return n.a.get("/api/DeviceInfo/QueryModbus",{params:{Id:t}})},k=function(t){return n.a.post("/api/DeviceInfo/saveModbus",t)},C=function(t,e){return n.a.get("/api/model/updateSymbol",{params:{sid:t,write:e}})}},908:function(t,e,r){t.exports={default:r(910),__esModule:!0}},910:function(t,e,r){r(213),r(134),t.exports=r(911)},911:function(t,e,r){var n=r(40),a=r(143);t.exports=r(14).getIterator=function(t){var e=a(t);if("function"!=typeof e)throw TypeError(t+" is not iterable!");return n(e.call(t))}}});